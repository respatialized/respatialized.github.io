<!DOCTYPE html>
<html><head><title>Respatialized | </title><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport" /><script async="async" src="js/prism.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js" type="text/javascript"></script><link href="css/fonts.css" rel="stylesheet" type="text/css" /><link href="css/main.css" rel="stylesheet" type="text/css" /></head><body><article lang="en"><section><p></p><div><h6>Error</h6><dl><dt>Error type</dt><dd><code>class clojure.lang.ExceptionInfo</code></dd><dt>Error message</dt><dd><code>Duplicate key: :line-height</code></dd><dt>Error phase</dt><dd><code></code></dd></dl><details><summary>Source expression</summary><pre><code>&lt;%(def page-style
       (css
       (at-import
&quot;https://fonts.googleapis.com/css2?family=Inter:wght@600;900&amp;display=swap&quot;)
       [:a {:color &quot;#C14825&quot;}]
       [:body {:background-color &quot;#EEE&quot;
       :font-size &quot;24px&quot;
       :font-family &quot;IBM Plex Sans&quot;
       :line-height 1.35
       :color &quot;#222&quot;
       :letter-spacing &quot;-0.01rem&quot;}]
       [:header {:font-weight 600
                 :font-family &quot;Inter&quot;}]
                        [:h1 :h2 :h3 {:font-size &quot;3rem&quot;
       :line-height &quot;3rem&quot;
       :margin-bottom &quot;0.6em&quot;
       :margin-top &quot;0.2em&quot;}]
                        [:blockquote {:font-weight 600
       :font-size &quot;1.45rem&quot;
       :line-height &quot;1.45&quot;
       :font-family &quot;Inter&quot;
                                      :line-height &quot;1.75rem&quot;}]
       [:pre :code
       {:white-space &quot;pre-wrap&quot;
       :font-family &quot;Recursive Mono Linear Static&quot;
       :font-height &quot;0.6rem&quot;
       :color &quot;#222&quot;
       :margin-bottom &quot;0.4em&quot;}]
       [:dt {:font-family &quot;Inter&quot;
       :margin-bottom &quot;0.2rem&quot;}]
       [:dd {:margin-bottom &quot;0.4rem&quot;}]
       [:summary {:margin-bottom &quot;0.4em&quot;}]
       [:article {:max-width &quot;45rem&quot;
                                   :padding-left &quot;20px&quot;
       :color &quot;#222&quot;  }]
       [:p {:margin-bottom &quot;0.4em&quot;
            :margin-top &quot;0.2em&quot;}]
       [:table {:font-size &quot;0.85rem&quot;
       :letter-spacing &quot;0.01rem&quot;
       :line-height &quot;1.45em&quot;
                :max-width &quot;90em&quot;}]
                        [:td :th {#_#_:border &quot;0.5px solid&quot;
                                  :padding &quot;0.25rem&quot;
                                  :text-align &quot;left&quot;}]
       [(select/attr &quot;colspan&quot;) {:text-align &quot;center&quot;
                                 :border-bottom &quot;0.5px solid&quot;
                                 :border-top &quot;0.5px solid&quot;
                                 }]
                        [:table {:border-collapse &quot;collapse&quot;
                                 :max-width &quot;1400px&quot;}]))%&gt;</code></pre></details></div><p>
</p><div><h6>Error</h6><dl><dt>Error type</dt><dd><code>class clojure.lang.Compiler$CompilerException</code></dd><dt>Error message</dt><dd><code>Unable to resolve symbol: page-style in this context</code></dd><dt>Error phase</dt><dd><code>:compile-syntax-check</code></dd></dl><details><summary>Source expression</summary><pre><code>&lt;%(def metadata {:title &quot;HOLOTYPE: blueprint&quot; :page-style page-style})%&gt;</code></pre></details></div><p>
</p><header><h1></h1><time datetime="2021-02-11">2021-02-11</time></header><p>Holotype will eventually become a library, distributable as an artifact separate from the context of its original creation. This page serves as a blueprint for that library.</p><figure><blockquote cite="http://nathanmarz.com/blog/suffering-oriented-programming.html">First make it possible. Then make it beautiful. Then make it fast.</blockquote><figcaption>Nathan Marz, <cite>Suffering-oriented programming</cite></figcaption></figure><p>Following Marz&apos;s advice, there will be three major phases of the work needed to make <code>holotype</code> a reality.</p><header><h3>Possible</h3></header><p>Because <code>holotype</code> exists mostly as idiosyncratic site generation code, I still need to make it <em>possible</em> to use outside of the context of this website. As Marz suggests, I am still feeling out the problem space in the context of a working prototype based on concrete examples.</p><p>As an example of following Marz&apos;s lead in building the prototype atop concrete uses, I generated the table below from an ordered map of features defined inline:</p><details><summary>Table source map</summary><pre><code class="language-clojure">{&quot;Preliminary API&quot;
 {:milestone &quot;Possible&quot;,
  :status &quot;Planned&quot;,
  :description
  &quot;A first pass at a public API for the post helper functions&quot;},
 &quot;Generative testing&quot;
 {:milestone &quot;Possible&quot;,
  :status &quot;Partially implemented&quot;,
  :description &quot;Leverage the HTML spec for high-performance testing&quot;},
 &quot;Database&quot;
 {:milestone &quot;Possible&quot;,
  :description &quot;Store post contents in a database&quot;},
 &quot;Metadata&quot;
 {:milestone &quot;Possible&quot;,
  :description &quot;Use HTML data attributes to propagate metadata&quot;},
 &quot;Schema&quot;
 {:milestone &quot;Possible&quot;,
  :status &quot;Partially implemented&quot;,
  :description &quot;Spec for HTML elements and for database entries&quot;},
 &quot;Legible HTML&quot;
 {:milestone &quot;Beautiful&quot;,
  :description &quot;Add linebreaks to HTML output to visualize structure&quot;},
 &quot;Code cleanup&quot;
 {:milestone &quot;Possible&quot;,
  :description
  &quot;Remove references to old branches, experimental code, and other extraneous aspects of the codebase&quot;},
 &quot;Error handling&quot;
 {:milestone &quot;Possible&quot;,
  :status &quot;Partially implemented&quot;,
  :description &quot;Surface parse/render errors in terminal and REPL&quot;},
 &quot;Configurable defaults&quot;
 {:milestone &quot;Possible&quot;,
  :description
  &quot;Override default template definitions + file extensions&quot;},
 &quot;Immediate rerenders&quot;
 {:milestone &quot;Beautiful&quot;,
  :description
  &quot;Refresh rerendered page content without manual browser reload&quot;},
 &quot;Stable API&quot;
 {:description
  &quot;A stable API for post helpers and for programmatic interaction with parsing and rendering capabilities&quot;,
  :milestone &quot;Beautiful&quot;},
 &quot;Autodocumentation&quot;
 {:description &quot;HTML for holotype generated by holotype&quot;,
  :milestone &quot;Beautiful&quot;},
 &quot;CLI / TUI&quot;
 {:description
  &quot;Terminal commands for invocation and inpsection of builds&quot;,
  :milestone &quot;Beautiful&quot;},
 &quot;Hiccup View&quot;
 {:description
  &quot;Get insight into how templates get parsed into documents&quot;,
  :milestone &quot;Beautiful&quot;},
 &quot;Data-driven styling&quot;
 {:description &quot;Constraint-based generation of CSS values&quot;,
  :milestone &quot;Beautiful&quot;},
 &quot;Live Validation&quot;
 {:description
  &quot;Incorporate schema definitions into error handling logic for real-time validation of HTML spec&quot;,
  :milestone &quot;Beautiful&quot;},
 &quot;Async processing&quot;
 {:milestone &quot;Fast&quot;, :description &quot;Asynchronous parsing + rendering&quot;},
 &quot;On-disk cache&quot;
 {:milestone &quot;Fast&quot;,
  :description &quot;Persist parsed contents on disk for fast rebuilds&quot;}}
</code></pre></details><p>
</p><details><summary><code>respatialized.render/map-&gt;table</code></summary><pre><code class="language-clojure">(defn
 map-&amp;gt;table
 &amp;quot;Converts the map to a table. Assumes keys are row headers and values\n  are maps of row entries (key:column/val:val).\n  Optionally breaks up the table into multiple &amp;lt;tbody&amp;gt; elements by an\n  additional attribute.&amp;quot;
 ([m subtable-attr]
  (let
   [body-keys
    (-&amp;gt;&amp;gt;
     m
     vals
     (map keys)
     flatten
     (into (ordered-set))
     ((fn [i] (disj i subtable-attr))))
    header
    (-&amp;gt;header (concat [&amp;quot;name&amp;quot;] body-keys))
    grouped-entries
    (-&amp;gt;&amp;gt;
     m
     (group-by (fn [[e vs]] (get vs subtable-attr)))
     (map
      (fn
       [[grp ms]]
       [grp
        (into
         {}
         (map
          (fn [[entry vs]] [entry (dissoc vs subtable-attr)])
          ms))])))]
   (apply
    conj
    [:table header]
    (map
     (fn [[sub-val vm]] (map-&amp;gt;tbody vm body-keys sub-val))
     grouped-entries))))
 ([m]
  (let
   [all-keys
    (-&amp;gt;&amp;gt; m vals (map keys) flatten (into (ordered-set)))
    header
    (-&amp;gt;header (concat [&amp;quot;name&amp;quot;] all-keys))]
   [:table header (map-&amp;gt;tbody m all-keys)])))
</code></pre></details><p>I didn&apos;t have that function before I wrote this post. Rather than writing a general-purpose &apos;table&apos; function from scratch, I allowed the shape of the data that made the most sense at the time of writing to guide the implementation. A lot of this phase will consist of work like that: specific solutions that serve as data points for a new series of abstractions that unify the design.</p><header><h3>Beautiful</h3></header><p>In this phase, API stability will allow for new features to be built on a stable foundation while maintaining extensibility. I consider it an important goal that the <code>holotype</code> code be usable as a <em>library</em>, not as an opinionated and auto-configuring <em>framework</em>, which is what I hope a disciplined approach to API design will allow.</p><header><h3>Fast</h3></header><p>This phase will focus on improving the responsiveness of interactions with the library. Due to the importance of real-time feedback for users of the library, latency is to be prioritized over throughput.</p><header><h3>Table of features</h3></header><table><thead><tr><th>name</th><th>status</th><th>description</th></tr></thead><tbody><tr><th colspan="3">Possible</th></tr><tr><th scope="row">Preliminary API</th><td>Planned</td><td>A first pass at a public API for the post helper functions</td></tr><tr><th scope="row">Generative testing</th><td>Partially implemented</td><td>Leverage the HTML spec for high-performance testing</td></tr><tr><th scope="row">Database</th><td></td><td>Store post contents in a database</td></tr><tr><th scope="row">Metadata</th><td></td><td>Use HTML data attributes to propagate metadata</td></tr><tr><th scope="row">Schema</th><td>Partially implemented</td><td>Spec for HTML elements and for database entries</td></tr><tr><th scope="row">Code cleanup</th><td></td><td>Remove references to old branches, experimental code, and other extraneous aspects of the codebase</td></tr><tr><th scope="row">Error handling</th><td>Partially implemented</td><td>Surface parse/render errors in terminal and REPL</td></tr><tr><th scope="row">Configurable defaults</th><td></td><td>Override default template definitions + file extensions</td></tr></tbody><tbody><tr><th colspan="3">Beautiful</th></tr><tr><th scope="row">Legible HTML</th><td></td><td>Add linebreaks to HTML output to visualize structure</td></tr><tr><th scope="row">Immediate rerenders</th><td></td><td>Refresh rerendered page content without manual browser reload</td></tr><tr><th scope="row">Stable API</th><td></td><td>A stable API for post helpers and for programmatic interaction with parsing and rendering capabilities</td></tr><tr><th scope="row">Autodocumentation</th><td></td><td>HTML for holotype generated by holotype</td></tr><tr><th scope="row">CLI / TUI</th><td></td><td>Terminal commands for invocation and inpsection of builds</td></tr><tr><th scope="row">Hiccup View</th><td></td><td>Get insight into how templates get parsed into documents</td></tr><tr><th scope="row">Data-driven styling</th><td></td><td>Constraint-based generation of CSS values</td></tr><tr><th scope="row">Live Validation</th><td></td><td>Incorporate schema definitions into error handling logic for real-time validation of HTML spec</td></tr></tbody><tbody><tr><th colspan="3">Fast</th></tr><tr><th scope="row">Async processing</th><td></td><td>Asynchronous parsing + rendering</td></tr><tr><th scope="row">On-disk cache</th><td></td><td>Persist parsed contents on disk for fast rebuilds</td></tr></tbody></table><header><h3>Features In Detail</h3></header><header><h4>Error handling</h4></header><p>Holotype features a parse and evaluate method that allows errors to be surfaced directly, in context. Here&apos;s an example:</p><div><h6>Error</h6><dl><dt>Error type</dt><dd><code>class clojure.lang.Compiler$CompilerException</code></dd><dt>Error message</dt><dd><code>Unable to resolve symbol: invalid-fn in this context</code></dd><dt>Error phase</dt><dd><code>:compile-syntax-check</code></dd></dl><details><summary>Source expression</summary><pre><code>&lt;%=(invalid-fn :input)%&gt;</code></pre></details></div><p>The error message encountered during the parse/eval step gets surfaced where the original source expression was in the page, allowing a user to quickly identify the cause and fix it. Particularly useful when paired with live page refreshing. Right now the focus is on allowing a user to see and respond to errors, but future work may add a machine-friendlier way of catching and responding to them.</p><p>
</p><header><h2>Design ethos</h2></header><dl><dt>Design for density</dt><dd>Try to maximize the information present on a page, both for human and machine consumers of it.</dd><dt>Simple things should be simple</dt><dd>A page should be fully renderable with plaintext only. Basic markup functions should not be intrusive to use.</dd><dt>Don&apos;t hide complexity</dt><dd>If a header is created by a function, the user should know that the header is created by a function. Complex behaviors should not be achieved &apos;automagically.&apos;</dd><dt>Complex things should be possible</dt><dd>The full power of a programming language should be in the hands of users without needing to rebuild/recompile the whole of the underlying source code.</dd></dl><p>
</p><header><h2>Technical debt/backlog</h2></header><ul><li><span>Add capability to include page-specific scripts analogous to <code>:page-style</code> for css</span></li><li><span>Refine API with <a href="https://clojure.org/news/2021/03/18/apis-serving-people-and-programs">clojure 1.11 option maps</a></span></li><li><span>Add defaults for <a href="https://css-tricks.com/a-complete-guide-to-data-attributes/">data attributes</a></span></li><li>Derive styling from data attributes</li><li>Implement descent-based search for smallest invalid hiccup forms</li><li>Fix character escaping</li></ul><p>
</p></section></article><footer class="mb7"><div><a href="/">Home</a></div></footer></body></html>